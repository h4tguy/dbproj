/* 
 * zoe.js 0.0.1
 * http://zoejs.org
 */(function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define(function(){return t()}):e.zoe=t()})(this,function(){var zoe={},console=typeof window!="undefined"?window.console=window.console||{}:global.console;console.dir=console.dir||function(){},console.log=console.log||function(){};var zoe_fn=zoe.fn=function(e,t){if(typeof e=="function"||typeof e=="string")t=e,e=null;var n=function(){return n.run(n._this||this,Array.prototype.splice.call(arguments,0),n.fns)};return n.constructor=zoe_fn,n.fns=e||[],n.run=(typeof t=="string"?zoe_fn[t]:t)||zoe_fn.LAST_DEFINED,n.on=on,n.off=off,n.first=first,n._this=undefined,n.bind=bind,n},bind=function(e){return this._this=e,this},on=function(e){return this.fns.push(e),this},off=function(e){if(!e){this.fns=[];return}for(var t=0;t<this.fns.length;t++)if(this.fns[t]==e){this.fns.splice(t,1);return}},first=function(e){return this.fns=[e].concat(this.fns),this};zoe_fn.executeReduce=function(e,t){return t===undefined&&(t=e,e=undefined),typeof e=="function"&&(e=e()),function(n,r,i){var s=e;for(var o=0;o<i.length;o++)s=t(s,i[o].apply(n,r));return s}};var l=zoe_fn.LAST_DEFINED=zoe_fn.executeReduce(function(e,t){return t!==undefined?t:e});zoe_fn.STOP_DEFINED=function(t,n,r){var i;for(var s=0;s<r.length;s++){i=r[s].apply(t,n);if(i!==undefined)return i}return i},zoe_fn.ASYNC=zoe_fn.ASYNC_NEXT=function(t,n,r){var i=0,s;if(r.length==0||n.length>=r[0].length&&typeof n[n.length-1]=="function")s=n.pop();var o=n,u=function(e){return function(){r[e]?(arguments.length&&(o=Array.prototype.splice.call(arguments,0)),r[e].length>=o.length+1||r[e].run==zoe_fn.ASYNC?r[e].apply(t,o.concat([u(e+1)])):(r[e].apply(t,o),u(e+1)())):s&&s()}};return u(0)()},zoe_fn.ASYNC_SIM=function(t,n,r){var i=0,s;typeof n[n.length-1]=="function"&&(s=n.pop());for(var o=0;o<r.length;o++)r[o].apply(t,n.concat([function(){++i==r.length&&s()}]))},zoe.on=function(e,t,n){var r=e[t];if(!r||r.constructor!=zoe_fn||r.run!=zoe_fn.LAST_DEFINED)e[t]=zoe_fn(r?[r]:[]);e[t].on(n)},zoe.off=function(e,t,n){if(e[t].constructor==zoe_fn)return e[t].off(n)};var zoe_extend=zoe.extend=function(t,n,r){t=t||{};var i=arguments;i.length>2&&(r=i[i.length-1]);var s;typeof r=="object"?(s=r,r=undefined):r||(n._extend&&(t._extend=zoe_extend(t._extend||{},n._extend,"REPLACE")),s=t._extend);if(s)for(var o in s){var u=o.indexOf(".");if(u!=-1){var a=o.substr(0,u);s[a]||(s[a]=zoe_extend)}}for(var o in n)if(!n.hasOwnProperty||n.hasOwnProperty(o)){if(o=="_extend")continue;var f=n[o],l,c=o.length,h=o.substr(0,2)=="__",p=o.substr(c-2,2)=="__",d=h&&!p&&(o=o.substr(2))&&zoe_extend.APPEND||!h&&p&&(o=o.substr(0,c-2))&&zoe_extend.PREPEND||h&&p&&(o=o.substr(2,c-4))&&zoe_extend.REPLACE,v=d||r||s&&(s[o]||s["*"])||zoe_extend.DEFINE;typeof v=="string"&&(v=zoe_extend[v]);try{l=v(t[o],f,s&&zoe_extend.deriveRules(s,o))}catch(m){throw console.dir(t),console.dir(n),console.dir(zoe_extend.deriveRules(r,o)),'zoe.extend: "'+o+'" override error. \n ->'+(m.message||m)}l!==undefined&&(t[o]=l)}if(i.length>3){var g=[t];g.concat(Array.prototype.splice.call(i,2,i.length-3,i.length-3)),g.push(r),$z.extend.apply(this,g)}return t};zoe_extend.EXTEND=zoe_extend,zoe_extend.DEFINE=function(t,n){if(t!==undefined)throw"No override specified.";return n},zoe_extend.REPLACE=function(t,n){return n!==undefined?n:t},zoe_extend.FILL=function(t,n){return t===undefined?n:t},zoe_extend.IGNORE=function(){};var is_obj=function(e){return e!=null&&e.constructor==Object},is_fn=function(e){return typeof e=="function"},is_str=function(e){return typeof e=="string"},is_arr=function(e){return e instanceof Array},default_rule=function(e,t){return e?typeof e=="string"?e:(e&&!e["*"]&&(e["*"]=t),e):t};zoe_extend.APPEND=function(t,n,r){return is_obj(n)?zoe_extend(is_obj(t)?t:{},n,default_rule(r,"REPLACE")):is_fn(n)?zoe_extend.CHAIN(t,n):is_str(n)?zoe_extend.STR_APPEND(t,n):is_arr(n)?zoe_extend.ARR_APPEND(t,n):n},zoe_extend.PREPEND=function(t,n,r){return is_obj(n)&&(t===undefined||is_obj(t))?zoe_extend(t||{},n,default_rule(r,"FILL")):is_fn(n)?zoe_extend.CHAIN_FIRST(t,n):is_str(n)?zoe_extend.STR_PREPEND(t,n):is_arr(n)?zoe_extend.ARR_PREPEND(t,n):t===undefined?n:t},zoe_extend.DAPPEND=function(t,n,r){return zoe_extend.APPEND(t,n,default_rule(r,"DAPPEND"))},zoe_extend.DPREPEND=function(t,n,r){return zoe.extend.PREPEND(t,n,default_rule(r,"DPREPEND"))},zoe_extend.DREPLACE=function(t,n,r){return is_obj(n)?zoe_extend(t||{},n,default_rule(r,"DREPLACE")):is_arr(n)?zoe_extend(t||[],n,default_rule(r,"DREPLACE")):n},zoe_extend.DFILL=function(t,n,r){return is_obj(n)?zoe_extend(t||{},n,default_rule(r,"DFILL")):typeof t=="undefined"?n:t},zoe_extend.ARR_APPEND=function(t,n){return t=t||[],t.concat||(t=[t]),t.concat(n)},zoe_extend.ARR_PREPEND=function(t,n){return n=n||[],n.concat||(n=[n]),n.concat(t||[])},zoe_extend.STR_APPEND=function(t,n){return t?t+n:n},zoe_extend.STR_PREPEND=function(t,n){return n+t},zoe_extend.deriveRules=function(e,t){var n;for(var r in e){if(r=="*")continue;var i=r.split(".");if(i[0]==t||i[0]=="*")n=n||{},n[i.splice(1).join(".")]=e[r]}return n},zoe_extend.makeChain=function(e,t){return typeof e=="string"&&(e=zoe_fn[e]),function(n,r){if(!n||n.constructor!=zoe_fn||n.run!=e)n=zoe_fn(n?[n]:[],e);return t?n.first(r):n.on(r),n}},zoe_extend.CHAIN=zoe_extend.makeChain(zoe_fn.LAST_DEFINED),zoe_extend.CHAIN_FIRST=zoe_extend.makeChain(zoe_fn.LAST_DEFINED,!0),zoe_extend.CHAIN_STOP_DEFINED=zoe_extend.makeChain(zoe_fn.STOP_DEFINED),zoe_extend.CHAIN_ASYNC=zoe_extend.makeChain(zoe_fn.ASYNC),zoe.create=function(e,t){t=inheritCheck(e,t),t._definition&&(t=t._definition);var n,r;implementLoop(t,function(e){n=n||e._base,r=r||e._name});var i=n?n(r):{};i._definition=t,i._extend={_name:zoe_extend.IGNORE,_base:zoe_extend.IGNORE,_implement:zoe_extend.IGNORE,_reinherit:zoe_extend.IGNORE,_make:zoe_extend.IGNORE,_integrate:zoe_extend.IGNORE,_built:zoe_extend.IGNORE};var s=[],o=zoe_fn(),u=zoe_fn();return u._this=o._this=i,implementLoop(t,function(n){n=u(n,t)||n,n._integrate&&u.on(n._integrate),zoe_extend(i,n),n._make&&n._make.call(i,t,n),n._built&&o.on(n._built),s.push(n)},function(t){return s.indexOf(t)!=-1&&!t._reinherit}),o(t),i};var implementLoop=function(e,t,n){n=n||function(){};if(e._implement)for(var r=0,i=e._implement.length;r<i;r++){var s=e._implement[r];s||(console.dir(e),console.log("Implementor not defined!")),s._definition&&(s=s._definition);if(n(s))continue;if(implementLoop(s,t,n))return!0}return t(e)},inheritCheck=function(e,t){return e instanceof Array||(t=e,e=[]),t=t||{},t._implement=e.concat(t._implement||[]),t};zoe.inherits=function(e,t){if(e._definition)return zoe.inherits(e._definition,t);if(t._definition)return zoe.inherits(e,t._definition);var n=!1;return implementLoop(e,function(e){if(e===t)return n=!0,!0}),n};var evalSupport=!1;try{eval(""),evalSupport=!0}catch(e){}return zoe.Constructor={_base:function(name){return evalSupport&&name&&name.match(/^[a-z]+$/i)?eval("(function "+name+"(){if("+name+".construct)"+name+".construct.apply(this, arguments);})"):function Constructor(){Constructor.construct&&Constructor.construct.apply(this,arguments)}},_extend:{prototype:zoe_extend,construct:zoe_extend.CHAIN},_integrate:function(e){if(typeof e=="function"&&!e._definition)return{construct:e,prototype:e.prototype};var t=Object.getOwnPropertyDescriptor;if(t){var n=t(e,"prototype");n&&!n.enumerable&&zoe_extend(this.prototype,e.prototype,zoe_extend.deriveRules(this._extend,"prototype"))}}},zoe_fn.COMPOSE_FIRST=function(t,n,r){if(r.length==0)return;var i=r[0].apply(t,n);n=i instanceof Array?i:n;for(var s=1;s<r.length;s++)r[s].apply(t,n)},zoe.InstanceEvents={_extend:{_events:"ARR_APPEND"},construct:function(){var e=this.constructor._events;if(!e)return;for(var t=0;t<e.length;t++){var n=e[t];this[n]=zoe.fn(this[n]?[this[n]]:[],this[n]?"COMPOSE_FIRST":"LAST_DEFINED").bind(this)}}},zoe});